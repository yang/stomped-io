Design Notes
============

Can start out with this simple linear lava, but consider adding something wave-y like this:

https://phaser.io/examples/v2/tile-sprites/tile-sprite-from-animated-sprite

Building
========

Run `yarn watch` first, at least once, before using `yarn dev`, so that it creates dist/main.proto.  (CopyWebpackPlugin
doesn't work well with the relative `to` path in webpack-dev-server mode.)

Run `yarn server` to start the server, which listens for a Chrome debugger.

Run `yarn build-prod` for a production build.

Dev Notes
=========

- May want to consider using simpler [AABB-only physics engine](https://gist.github.com/BonsaiDen/6144232).
- Bot names from https://www.findnicknames.com/cool-gamer-tags/

Multiplayer Engines
-------------------

- IGE: only supports interpolation; odd conventions
- Colyseus: focused on administrivia
- Timeline: simple micro library for interpolation
- Lance:
  - requires heavy framework buy-in, I foresee fighting against it
  - extrapolation is over *everything*, not selective player-affected things

Ultimately, just going with home-rolled (maybe with some assistance from
TImeline), but Lance seems like the most promising if things get hairy quickly.

Misc
----

- `moduleResolution: node` is from
  https://github.com/Microsoft/TypeScript/issues/8189

Checklists
==========

Adding a new character:

- clone player-plain.svg to inherit the correct leg structure, so that spriter can animate them
- save the new svg as designs/player-XXX.svg
- add XXX-0 to src/chars.txt and XXX to Common.playerStyleIndividuals
- add XXX config to Spriter.chars - mind any protrusions, adjust width/height accordingly (or else, clipping!)

Performance
===========

The first few `runSims` run times when using `deepCloneWorld`:

- 3363.185
- 3166.084999999999
- 2408.605000000003
- 1400.454999999998
- 1011.4200000000019

The first few `runSims` run times when using `manuallyCloneWorld`:

- 1597.4000000000005
- 1660.640000000003
- 869.0249999999978
- 762.75
- 850.2850000000108
- 376.13500000000204

Deployment
==========

Open ports 80, 3000.

Instructions tested on Ubuntu 16.04.

On the host:

    # One-time setup
    sudo apt install nginx virtualenvwrapper unzip apache2-utils postgresql
    sudo hostname blah.stomped.io
    echo blah.stomped.io | sudo tee /etc/hostname

    # Database setup
    sudo -u postgres psql
        create user bounce with login;
        \password bounce
        create database bounce owner bounce;
    # Update .pgpass
    psql -h localhost -U bounce bounce
        create table daily_stats (host text, date date, data text, unique (host, date));
        create table load (host text unique, time timestamp, humans int, bots int);

    # Log out and back in
    mkvirtualenv bounce
    pip install nodeenv
    nodeenv -n 6.11.2 ~/.node/bounce/
    . ~/.node/bounce/bin/activate
    npm install -g yarn

    sudo htpasswd -c /etc/apache2/bounce.htpasswd yang

Set up letsencrypt, and edit the nginx config to look like the one in tools/.

From your client:

    # Start once
    yarn watch
    yarn watch-css

    # Deployment - specify the IP
    # You must commit your work before deploying!
    bash -x tools/deploy.bash 45.79.94.70

Back on the host:

    # One-time host app setup
    cd bounce/
    mkdir -p web/
    for i in index.html admin.html client.html advertisement.js assets/ build/ designs/ dist/ updates.txt myicon.ico ; do
        ln -s ../$i web/
    done

    # Each-time
    . ~/.node/gen/bin/activate
    yarn install
    yarn server

nginx
-----

    server {
      listen 80;
      root /home/yang/bounce/web;
      index index.html index.htm index.nginx-debian.html;

      location /build/ {
        auth_basic "Admin Area";
        auth_basic_user_file /etc/apache2/bounce.htpasswd;
      }

      location /dist/maps/ {
        auth_basic "Admin Area";
        auth_basic_user_file /etc/apache2/bounce.htpasswd;
      }
    }
